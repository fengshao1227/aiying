# V2 系统配置模块 API 文档

## 基础信息

- **Base URL**: `/v2/config`
- **Content-Type**: `application/json`
- **Accept**: `application/json`
- **认证方式**: 无需认证（公开接口）

---

## 1. 获取所有配置

### 接口信息
- **URL**: `/v2/config`
- **Method**: `GET`
- **认证**: 无需认证

### 请求参数
无

### 请求示例
```
GET /v2/config
```

### 响应格式
**成功响应 (200)**:
```json
{
  "code": 0,
  "message": "获取成功",
  "data": [
    {
      "id": 1,
      "key": "points_rate",
      "value": "100",
      "description": "积分兑换比例：消费100元获得1积分",
      "created_at": "2025-12-20T10:00:00.000000Z",
      "updated_at": "2025-12-20T10:00:00.000000Z"
    },
    {
      "id": 2,
      "key": "points_deduction_rate",
      "value": "0.01",
      "description": "积分抵扣比例：1积分抵扣0.01元",
      "created_at": "2025-12-20T10:00:00.000000Z",
      "updated_at": "2025-12-20T10:00:00.000000Z"
    },
    {
      "id": 3,
      "key": "max_points_deduction_percent",
      "value": "50",
      "description": "最大积分抵扣比例：订单金额的50%",
      "created_at": "2025-12-20T10:00:00.000000Z",
      "updated_at": "2025-12-20T10:00:00.000000Z"
    }
  ]
}
```

### 响应字段说明
| 字段 | 类型 | 说明 |
|------|------|------|
| `id` | integer | 配置ID |
| `key` | string | 配置键名 |
| `value` | string | 配置值 |
| `description` | string/null | 配置描述 |
| `created_at` | string | 创建时间（ISO 8601格式） |
| `updated_at` | string | 更新时间（ISO 8601格式） |

---

## 2. 获取积分配置

### 接口信息
- **URL**: `/v2/config/points`
- **Method**: `GET`
- **认证**: 无需认证

### 请求参数
无

### 请求示例
```
GET /v2/config/points
```

### 响应格式
**成功响应 (200)**:
```json
{
  "code": 0,
  "message": "获取成功",
  "data": {
    "points_rate": 100,
    "points_deduction_rate": 0.01,
    "max_points_deduction_percent": 50
  }
}
```

**配置不完整 (400)**:
```json
{
  "code": 400,
  "message": "积分配置不完整",
  "data": null
}
```

### 响应字段说明
| 字段 | 类型 | 说明 |
|------|------|------|
| `points_rate` | integer | 积分获取比例（消费多少元获得1积分） |
| `points_deduction_rate` | float | 积分抵扣比例（1积分抵扣多少元） |
| `max_points_deduction_percent` | integer | 最大积分抵扣比例（订单金额的百分比） |

### 业务说明
- 此接口专门用于获取积分相关配置
- 返回格式化后的积分配置数据，便于前端使用
- 如果任一配置项缺失，返回400错误

---

## 3. 获取单个配置

### 接口信息
- **URL**: `/v2/config/{key}`
- **Method**: `GET`
- **认证**: 无需认证

### 路径参数
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `key` | string | 是 | 配置键名 |

### 请求示例
```
GET /v2/config/points_rate
```

### 响应格式
**成功响应 (200)**:
```json
{
  "code": 0,
  "message": "获取成功",
  "data": {
    "id": 1,
    "key": "points_rate",
    "value": "100",
    "description": "积分兑换比例：消费100元获得1积分",
    "created_at": "2025-12-20T10:00:00.000000Z",
    "updated_at": "2025-12-20T10:00:00.000000Z"
  }
}
```

**配置不存在 (404)**:
```json
{
  "code": 404,
  "message": "配置不存在",
  "data": null
}
```

---

## 常用配置键名

### 积分相关配置
| 配置键名 | 说明 | 示例值 |
|---------|------|--------|
| `points_rate` | 积分获取比例（消费多少元获得1积分） | 100 |
| `points_deduction_rate` | 积分抵扣比例（1积分抵扣多少元） | 0.01 |
| `max_points_deduction_percent` | 最大积分抵扣比例（订单金额的百分比） | 50 |

### 其他配置
根据业务需求，可能包含其他系统配置项，如：
- 配送费用配置
- 订单超时时间
- 客服联系方式
- 小程序版本信息
等

---

## 通用错误码

| 错误码 | 说明 |
|--------|------|
| 0 | 成功 |
| 400 | 请求参数错误或配置不完整 |
| 404 | 配置不存在 |
| 500 | 服务器内部错误 |

---

## 使用场景说明

### 1. 小程序初始化
小程序启动时调用 `/v2/config` 获取所有配置，缓存到本地

### 2. 积分计算
在订单结算页面，调用 `/v2/config/points` 获取积分配置，用于：
- 计算订单可获得的积分
- 计算积分可抵扣的金额
- 验证积分使用是否超过限制

### 3. 动态配置
通过配置接口，可以实现：
- 无需发版即可调整业务规则
- 灵活控制积分策略
- 快速响应运营需求

### 4. 缓存建议
- 建议前端缓存配置数据，减少请求
- 配置变更频率低，可设置较长缓存时间（如1小时）
- 关键业务操作时，建议重新获取最新配置

---

## 配置管理说明

### 后台管理
- 系统配置由管理后台统一管理
- 支持动态修改配置值
- 修改后立即生效，无需重启服务

### 数据格式
- 所有配置值以字符串形式存储
- 前端需根据业务需求进行类型转换
- 建议使用 `parseInt()` 或 `parseFloat()` 处理数值类型

### 扩展性
- 支持添加新的配置项
- 配置项通过 `key` 唯一标识
- 建议使用语义化的配置键名
